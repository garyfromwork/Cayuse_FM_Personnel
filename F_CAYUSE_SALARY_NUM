create or replace FUNCTION         F_CAYUSE_SALARY_NUM 
(
  CID IN VARCHAR2
, POSN IN VARCHAR2
, POSN_START_DATE IN DATE
) RETURN NUMBER AS 
JOB_COUNT NUMBER;
BEGIN
    SELECT CASE WHEN COUNT(NBRJOBS_POSN) < 10 THEN
        SFADATA.F_GET_FSYR(NBRJOBS_EFFECTIVE_DATE) || '0' || COUNT(NBRJOBS_POSN)
    ELSE SFADATA.F_GET_FSYR(NBRJOBS_EFFECTIVE_DATE) || COUNT(NBRJOBS_POSN) END
    INTO JOB_COUNT
    FROM NBRJOBS
    INNER JOIN NBRBJOB
        ON NBRBJOB_PIDM = NBRJOBS_PIDM
        AND NBRBJOB_POSN = NBRJOBS_POSN
        AND NBRBJOB_BEGIN_DATE = NBRJOBS_EFFECTIVE_DATE
    INNER JOIN SPRIDEN
        ON SPRIDEN_PIDM = NBRJOBS_PIDM
        AND SPRIDEN_ID = CID
        AND SPRIDEN_CHANGE_IND IS NULL
    WHERE NBRJOBS_EFFECTIVE_DATE <= SYSDATE
    AND NBRJOBS_POSN = POSN
    AND NBRJOBS_EFFECTIVE_DATE = POSN_START_DATE
    AND NBRJOBS_STATUS = 'A'
    GROUP BY NBRJOBS_POSN, NBRJOBS_EFFECTIVE_DATE;
    RETURN JOB_COUNT;
END F_CAYUSE_SALARY_NUM;
